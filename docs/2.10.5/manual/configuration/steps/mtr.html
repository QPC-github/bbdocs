

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>2.5.11.29. MTR (mysql-test-run) &mdash; Buildbot 2.10.5 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/buildbot_rtd.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/icon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="2.5.11.30. SubunitShellCommand" href="subunit_shell_command.html" />
    <link rel="prev" title="2.5.11.28. PerlModuleTest" href="perl_module_test.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Buildbot
          

          
            
            <img src="../../../_static/full_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.10.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../buildfactories.html">2.5.8. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../buildsets.html">2.5.9. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../properties.html">2.5.10. Properties</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">2.5.11. Build Steps</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="common.html">2.5.11.1. Parameters Common to all Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_common.html">2.5.11.2. Common Parameters of source checkout operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_bzr.html">2.5.11.3. Bzr</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_cvs.html">2.5.11.4. CVS</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_darcs.html">2.5.11.5. Darcs</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_gerrit.html">2.5.11.6. Gerrit</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_github.html">2.5.11.7. GitHub</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_gitlab.html">2.5.11.8. GitLab</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_git.html">2.5.11.9. Git</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_mercurial.html">2.5.11.10. Mercurial</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_monotone.html">2.5.11.11. Monotone</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_p4.html">2.5.11.12. P4</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_repo.html">2.5.11.13. Repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_svn.html">2.5.11.14. SVN</a></li>
<li class="toctree-l4"><a class="reference internal" href="gitcommit.html">2.5.11.15. GitCommit</a></li>
<li class="toctree-l4"><a class="reference internal" href="gittag.html">2.5.11.16. GitTag</a></li>
<li class="toctree-l4"><a class="reference internal" href="gitpush.html">2.5.11.17. GitPush</a></li>
<li class="toctree-l4"><a class="reference internal" href="shell_command.html">2.5.11.18. ShellCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="shell_sequence.html">2.5.11.19. Shell Sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="compile.html">2.5.11.20. Compile</a></li>
<li class="toctree-l4"><a class="reference internal" href="configure.html">2.5.11.21. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="cmake.html">2.5.11.22. CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="visual_cxx.html">2.5.11.23. Visual C++</a></li>
<li class="toctree-l4"><a class="reference internal" href="cppcheck.html">2.5.11.24. Cppcheck</a></li>
<li class="toctree-l4"><a class="reference internal" href="robocopy.html">2.5.11.25. Robocopy</a></li>
<li class="toctree-l4"><a class="reference internal" href="test.html">2.5.11.26. Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="treesize.html">2.5.11.27. TreeSize</a></li>
<li class="toctree-l4"><a class="reference internal" href="perl_module_test.html">2.5.11.28. PerlModuleTest</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">2.5.11.29. MTR (mysql-test-run)</a></li>
<li class="toctree-l4"><a class="reference internal" href="subunit_shell_command.html">2.5.11.30. SubunitShellCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="hlint.html">2.5.11.31. HLint</a></li>
<li class="toctree-l4"><a class="reference internal" href="maxq.html">2.5.11.32. MaxQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="trigger.html">2.5.11.33. Trigger</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_epydoc.html">2.5.11.34. BuildEPYDoc</a></li>
<li class="toctree-l4"><a class="reference internal" href="pyflakes.html">2.5.11.35. PyFlakes</a></li>
<li class="toctree-l4"><a class="reference internal" href="sphinx.html">2.5.11.36. Sphinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="pylint.html">2.5.11.37. PyLint</a></li>
<li class="toctree-l4"><a class="reference internal" href="trial.html">2.5.11.38. Trial</a></li>
<li class="toctree-l4"><a class="reference internal" href="remove_pycs.html">2.5.11.39. RemovePYCs</a></li>
<li class="toctree-l4"><a class="reference internal" href="http_step.html">2.5.11.40. HTTP Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="worker_filesystem.html">2.5.11.41. Worker Filesystem Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_transfer.html">2.5.11.42. Transferring Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_transfer.html#transferring-strings">2.5.11.43. Transferring Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="master_shell_command.html">2.5.11.44. MasterShellCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="log_renderable.html">2.5.11.45. LogRenderable</a></li>
<li class="toctree-l4"><a class="reference internal" href="assert.html">2.5.11.46. Assert</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_property.html">2.5.11.47. SetProperty</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_properties.html">2.5.11.48. SetProperties</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_property_from_command.html">2.5.11.49. SetPropertyFromCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_properties_from_env.html">2.5.11.50. SetPropertiesFromEnv</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpm_build.html">2.5.11.51. RpmBuild</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpm_lint.html">2.5.11.52. RpmLint</a></li>
<li class="toctree-l4"><a class="reference internal" href="mock_build_srpm.html">2.5.11.53. MockBuildSRPM Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="mock_rebuild.html">2.5.11.54. MockRebuild</a></li>
<li class="toctree-l4"><a class="reference internal" href="deb_pbuilder.html">2.5.11.55. DebPbuilder</a></li>
<li class="toctree-l4"><a class="reference internal" href="deb_pbuilder.html#debcowbuilder">2.5.11.56. DebCowbuilder</a></li>
<li class="toctree-l4"><a class="reference internal" href="deb_lintian.html">2.5.11.57. DebLintian</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#id2">2.5.11.58. Build steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../interlocks.html">2.5.12. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../report_generators/index.html">2.5.13. Report Generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reporters/index.html">2.5.14. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../www.html">2.5.15. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wwwhooks.html">2.5.16. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services.html">2.5.17. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dbconfig.html">2.5.18. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configurators.html">2.5.19. Configurators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manhole.html">2.5.20. Manhole</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multimaster.html">2.5.21. Multimaster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multicodebase.html">2.5.22. Multiple-Codebase Builds</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../relnotes/index.html">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../relnotes/index.html#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../indices.html">6. API Indices</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Buildbot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html"><span class="section-number">2. </span>Buildbot Manual</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">2.5. </span>Configuration</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2.5.11. </span>Build Steps</a> &raquo;</li>
        
      <li><span class="section-number">2.5.11.29. </span>MTR (mysql-test-run)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/manual/configuration/steps/mtr.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Buildbot no longer supports Python 2.7 on the Buildbot master.</p>
</div>
<div class="section" id="mtr-mysql-test-run">
<span id="step-mtr"></span><span id="step-MTR"></span><h1><span class="section-number">2.5.11.29. </span>MTR (mysql-test-run)<a class="headerlink" href="#mtr-mysql-test-run" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#step-MTR" title="MTR"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MTR</span></code></a> class is a subclass of <a class="reference internal" href="test.html#step-Test" title="Test"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Test</span></code></a>.
It is used to run test suites using the mysql-test-run program, as used in MySQL, Drizzle, MariaDB, and MySQL storage engine plugins.</p>
<p>The shell command to run the test suite is specified in the same way as for the <a class="reference internal" href="test.html#step-Test" title="Test"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Test</span></code></a> class.
The <a class="reference internal" href="#step-MTR" title="MTR"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MTR</span></code></a> class will parse the output of running the test suite, and use the count of tests executed so far to provide more accurate completion time estimates.
Any test failures that occur during the test are summarized on the Waterfall Display.</p>
<p>Server error logs are added as additional log files, useful to debug test failures.</p>
<p>Optionally, data about the test run and any test failures can be inserted into a database for further analysis and report generation.
To use this facility, create an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></code> with connections to the database.
The necessary tables can be created automatically by setting <code class="docutils literal notranslate"><span class="pre">autoCreateTables</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>, or manually using the SQL found in the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/steps/mtrlogobserver.py">mtrlogobserver.py</a> source file.</p>
<p>One problem with specifying a database is that each reload of the configuration will get a new instance of <code class="docutils literal notranslate"><span class="pre">ConnectionPool</span></code> (even if the connection parameters are the same).
To avoid that Buildbot thinks the builder configuration has changed because of this, use the <code class="xref py py-class docutils literal notranslate"><span class="pre">steps.mtrlogobserver.EqConnectionPool</span></code> subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPool</span></code>, which implements an equality operation that avoids this problem.</p>
<p>Example use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">myPool</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">EqConnectionPool</span><span class="p">(</span><span class="s2">&quot;MySQLdb&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;buildbot&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;db&quot;</span><span class="p">)</span>
<span class="n">myFactory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MTR</span><span class="p">(</span><span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;mysql-test&quot;</span><span class="p">,</span> <span class="n">dbpool</span><span class="o">=</span><span class="n">myPool</span><span class="p">,</span>
                            <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;perl&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql-test-run.pl&quot;</span><span class="p">,</span> <span class="s2">&quot;--force&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#step-MTR" title="MTR"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MTR</span></code></a> step’s arguments are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">textLimit</span></code></dt><dd><p>Maximum number of test failures to show on the waterfall page (to not flood the page in case of a large number of test failures.
Defaults to 5.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">testNameLimit</span></code></dt><dd><p>Maximum length of test names to show unabbreviated in the waterfall page, to avoid excessive column width.
Defaults to 16.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">parallel</span></code></dt><dd><p>Value of option <cite>–parallel</cite> option used for <code class="file docutils literal notranslate"><span class="pre">mysql-test-run.pl</span></code> (number of processes used to run the test suite in parallel).
Defaults to 4.
This is used to determine the number of server error log files to download from the worker.
Specifying a too high value does not hurt (as nonexistent error logs will be ignored), however if using option <cite>–parallel</cite> value greater than the default it needs to be specified, or some server error logs will be missing.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dbpool</span></code></dt><dd><p>An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.
If specified, results are inserted into the database using the <code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPool</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">autoCreateTables</span></code></dt><dd><p>Boolean, defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code> (and <code class="docutils literal notranslate"><span class="pre">dbpool</span></code> is specified), the necessary database tables will be created automatically if they do not exist already.
Alternatively, the tables can be created manually from the SQL statements found in the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/steps/mtrlogobserver.py">mtrlogobserver.py</a> source file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_type</span></code></dt><dd><p>Short string that will be inserted into the database in the row for the test run.
Defaults to the empty string, but can be specified to identify different types of test runs.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_info</span></code></dt><dd><p>Descriptive string that will be inserted into the database in the row for the test run.
Defaults to the empty string, but can be specified as a user-readable description of this particular test run.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mtr_subdir</span></code></dt><dd><p>The subdirectory in which to look for server error log files.
Defaults to <code class="file docutils literal notranslate"><span class="pre">mysql-test</span></code>, which is usually correct.
<a class="reference internal" href="../properties.html#interpolate"><span class="std std-ref">Interpolate</span></a> is supported.</p>
</dd>
</dl>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="subunit_shell_command.html" class="btn btn-neutral float-right" title="2.5.11.30. SubunitShellCommand" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="perl_module_test.html" class="btn btn-neutral float-left" title="2.5.11.28. PerlModuleTest" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Buildbot Team Members.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>